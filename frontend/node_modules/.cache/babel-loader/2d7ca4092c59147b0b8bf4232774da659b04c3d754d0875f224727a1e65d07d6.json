{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\rucha\\\\Life-Tag - Copy\\\\frontend\\\\src\\\\components\\\\DoctorRequests.js\",\n  _s = $RefreshSig$();\n// src/components/DoctorRequests.js\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport apiClient from \"../api\";\nimport { useAuth } from \"./context/AuthContext\";\nimport \"./DoctorRequests.css\";\nimport CountdownTimer from \"./CountdownTimer\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst DoctorRequests = () => {\n  _s();\n  const [requests, setRequests] = useState([]);\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const {\n    auth\n  } = useAuth();\n  const fetchRequests = useCallback(async () => {\n    // ... (fetchRequests logic is unchanged) ...\n    if (!(auth !== null && auth !== void 0 && auth.token) || !(auth !== null && auth !== void 0 && auth.id)) {\n      setLoading(false);\n      setError(\"User not authenticated.\");\n      return;\n    }\n    setLoading(true);\n    try {\n      const response = await apiClient.get(`/access/doctor/${auth.id}`, {\n        headers: {\n          Authorization: `Bearer ${auth.token}`\n        }\n      });\n      const activeRequests = response.data.filter(req => req.status === \"pending\" || req.status === \"approved\");\n      setRequests(activeRequests);\n      setLoading(false);\n    } catch (err) {\n      var _err$response, _err$response$data;\n      console.error(\"Error fetching requests:\", err);\n      setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || \"Failed to fetch requests.\");\n      setLoading(false);\n    }\n  }, [auth]);\n\n  // 3. Fetch requests when the component loads AND poll for updates\n  useEffect(() => {\n    // 1. Fetch data immediately on load\n    fetchRequests();\n\n    // 2. Set up an interval to re-fetch every 5 seconds\n    const intervalId = setInterval(() => {\n      fetchRequests();\n    }, 5000); // 5000ms = 5 seconds\n\n    // 3. This is crucial: stop the interval when you leave the page\n    //    to prevent memory leaks.\n    return () => clearInterval(intervalId);\n  }, [fetchRequests]); // We already use useCallback, so this is safe\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Loading requests...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 12\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"error-message\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"page-header\",\n      children: \"My Sent Requests\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }, this), requests.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"You have no active or pending requests.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"doctor-requests-list\",\n      children: requests.map(req => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"doctor-request-item\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"request-details\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: [\"Patient ID: \", req.Patient ? req.Patient.patientTagId : 'N/A']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 72,\n            columnNumber: 17\n          }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"Name: \", req.Patient ? req.Patient.fullName : 'Unknown Patient']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"notes\",\n            children: [\"Notes: \\\"\", req.notes || \"N/A\", \"\\\"\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 74,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"request-status\",\n          children: [req.status === \"approved\" && req.expiresAt ? /*#__PURE__*/_jsxDEV(CountdownTimer, {\n            expiresAt: req.expiresAt,\n            onExpire: fetchRequests\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 19\n          }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n            className: `status-badge status-${req.status}`,\n            children: req.status\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"request-date\",\n            children: new Date(req.createdAt).toLocaleDateString()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 76,\n          columnNumber: 15\n        }, this)]\n      }, req.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n};\n_s(DoctorRequests, \"cBZl5NimgOba+lkAr7B7AB/lckk=\", false, function () {\n  return [useAuth];\n});\n_c = DoctorRequests;\nexport default DoctorRequests;\nvar _c;\n$RefreshReg$(_c, \"DoctorRequests\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","apiClient","useAuth","CountdownTimer","jsxDEV","_jsxDEV","Fragment","_Fragment","DoctorRequests","_s","requests","setRequests","error","setError","loading","setLoading","auth","fetchRequests","token","id","response","get","headers","Authorization","activeRequests","data","filter","req","status","err","_err$response","_err$response$data","console","message","intervalId","setInterval","clearInterval","children","fileName","_jsxFileName","lineNumber","columnNumber","className","length","map","Patient","patientTagId","fullName","notes","expiresAt","onExpire","Date","createdAt","toLocaleDateString","_c","$RefreshReg$"],"sources":["C:/Users/rucha/Life-Tag - Copy/frontend/src/components/DoctorRequests.js"],"sourcesContent":["// src/components/DoctorRequests.js\r\nimport React, { useState, useEffect, useCallback } from \"react\";\r\nimport apiClient from \"../api\";\r\nimport { useAuth } from \"./context/AuthContext\";\r\nimport \"./DoctorRequests.css\";\r\nimport CountdownTimer from \"./CountdownTimer\";\r\n\r\nconst DoctorRequests = () => {\r\n  const [requests, setRequests] = useState([]);\r\n  const [error, setError] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const { auth } = useAuth();\r\n\r\n  const fetchRequests = useCallback(async () => {\r\n    // ... (fetchRequests logic is unchanged) ...\r\n    if (!auth?.token || !auth?.id) {\r\n      setLoading(false);\r\n      setError(\"User not authenticated.\");\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      const response = await apiClient.get(`/access/doctor/${auth.id}`, {\r\n        headers: { Authorization: `Bearer ${auth.token}` },\r\n      });\r\n      const activeRequests = response.data.filter(\r\n        (req) => req.status === \"pending\" || req.status === \"approved\"\r\n      );\r\n      setRequests(activeRequests);\r\n      setLoading(false);\r\n    } catch (err) {\r\n      console.error(\"Error fetching requests:\", err);\r\n      setError(err.response?.data?.message || \"Failed to fetch requests.\");\r\n      setLoading(false);\r\n    }\r\n  }, [auth]);\r\n\r\n  // 3. Fetch requests when the component loads AND poll for updates\r\n  useEffect(() => {\r\n    // 1. Fetch data immediately on load\r\n    fetchRequests();\r\n\r\n    // 2. Set up an interval to re-fetch every 5 seconds\r\n    const intervalId = setInterval(() => {\r\n      fetchRequests();\r\n    }, 5000); // 5000ms = 5 seconds\r\n\r\n    // 3. This is crucial: stop the interval when you leave the page\r\n    //    to prevent memory leaks.\r\n    return () => clearInterval(intervalId);\r\n  }, [fetchRequests]); // We already use useCallback, so this is safe\r\n\r\n  if (loading) {\r\n    return <p>Loading requests...</p>;\r\n  }\r\n\r\n  if (error) {\r\n    return <p className=\"error-message\">{error}</p>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <h2 className=\"page-header\">My Sent Requests</h2>\r\n\r\n      {requests.length === 0 ? (\r\n        <p>You have no active or pending requests.</p>\r\n      ) : (\r\n        <div className=\"doctor-requests-list\">\r\n          {requests.map((req) => (\r\n            <div key={req.id} className=\"doctor-request-item\">\r\n              <div className=\"request-details\">\r\n                <strong>Patient ID: {req.Patient ? req.Patient.patientTagId : 'N/A'}</strong> {/* Use patientTagId */}\r\n                <span>Name: {req.Patient ? req.Patient.fullName : 'Unknown Patient'}</span>\r\n                <span className=\"notes\">Notes: \"{req.notes || \"N/A\"}\"</span>\r\n              </div>\r\n              <div className=\"request-status\">\r\n                {req.status === \"approved\" && req.expiresAt ? (\r\n                  <CountdownTimer\r\n                    expiresAt={req.expiresAt}\r\n                    onExpire={fetchRequests}\r\n                  />\r\n                ) : (\r\n                  <span className={`status-badge status-${req.status}`}>\r\n                    {req.status}\r\n                  </span>\r\n                )}\r\n                <span className=\"request-date\">\r\n                  {new Date(req.createdAt).toLocaleDateString()}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default DoctorRequests;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}